{% load compress %}
{% load static %}
{% load django_browser_reload %}
<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add Flower</title>
    {% compress css %}
        <link rel="stylesheet" href="{% static '/css/dist/styles.css' %}">
    {% endcompress %}
</head>
<body class="h-full flex flex-col">
<div class="container mx-auto px-4 py-8 flex-grow overflow-hidden">
    <div class="slider-container relative mb-4">
        <label for="date-slider" class="block mb-2">Select Date:</label>
        <div class="flex items-center">
            <input type="range" id="date-slider" min=1 max=12 value=9 oninput="updateFlowerVisibility()" class="w-full">
            <span id="slider-value" class="ml-2">9</span>
        </div>
    </div>

    <div class="mb-4">
        <form method="post" enctype="multipart/form-data" class="flex flex-row space-x-4">
            {% csrf_token %}
            <div class="mt-4">
                <a href="{% url 'show' %}" class="text-blue-500 hover:text-blue-700">View Flower List</a>
            </div>
            <div class="flex items-center space-x-2">
                {{ form }}
            </div>
            <button type="submit" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">Add Flower</button>
        </form>
    </div>

    <div class="relative h-[80%] overflow-hidden border border-gray-200 rounded" id="flowerbed">
        <ul class="list-none absolute inset-0">
            {% for flower in flowers %}
                <li id="flower-{{ flower.id }}" class="absolute" style="left: {{ flower.x_position }}px; top: {{ flower.y_position }}px" data-start-date="{{ flower.start_date }}" data-end-date="{{ flower.end_date }}">
                    <img src="{{ flower.image_url }}" alt="{{ flower.name }}" class="w-12 h-12 object-cover">
                    <span class="text-xs">{{ flower.name }}</span>
                </li>
            {% endfor %}
        </ul>
    </div>


</div>

<script>
    // Your existing JavaScript code here
    // Function to update the slider value and filter flowers by ID
    function updateFlowerVisibility() {
        var slider = document.getElementById('date-slider');
        var sliderValue = slider.value;
        document.getElementById('slider-value').textContent = sliderValue;

        // Loop through each flower by id and show/hide based on start_date
        {% for flower in flowers %}
            var flowerElement = document.getElementById('flower-{{ flower.id }}');
            var startDate = flowerElement.getAttribute('data-start-date');
            var endDate = flowerElement.getAttribute('data-end-date');

            // Compare flower's start_date with the slider value
            if (parseInt(startDate) <= sliderValue && parseInt(endDate) >= sliderValue) {
                flowerElement.style.display = 'block'; // Show flower
            } else {
                flowerElement.style.display = 'none';  // Hide flower
            }
        {% endfor %}
    }

    const slider = document.getElementById('date-slider');
    const sliderValue = document.getElementById('slider-value');

    // Function to handle scrolling
    document.addEventListener('wheel', function (event) {
        event.preventDefault(); // Prevent the page from scrolling
        console.log("hi")
        // Check the direction of scroll: up or down
        if (event.deltaY < 0 && parseInt(slider.value) < parseInt(slider.max)) {
            slider.value++;
        } else if (event.deltaY > 0 && parseInt(slider.value) > parseInt(slider.min)) {
            slider.value--;
        }

        // Update the displayed value and trigger your visibility logic
        updateFlowerVisibility();
    });

    // Call the function once to initialize the visibility based on the default slider value
    updateFlowerVisibility();

    const xInput = document.getElementById('id_x_position');
const yInput = document.getElementById('id_y_position');

// Add a click event listener to the specific HTML element (flowerbed)
const flowerbed = document.getElementById('flowerbed');
flowerbed.addEventListener('click', function (event) {
    // Get the bounding rectangle of the flowerbed element
    const rect = flowerbed.getBoundingClientRect();

    // Calculate the x and y coordinates relative to the flowerbed element
    const x = event.clientX - rect.left;
    const y = event.clientY - rect.top;

    // Set the input fields with the coordinates relative to the element
    xInput.value = x;
    yInput.value = y;
});

</script>
</body>
</html>
